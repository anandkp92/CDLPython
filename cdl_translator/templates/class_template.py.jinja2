"""{{ model.metadata.description }}

Auto-generated from CDL model: {{ model.metadata.name }}
Generated by: CDL to Python Translator
"""

from typing import Dict, Any
{% if model.needs_time_manager() %}
from cdl_python.time_manager import TimeManager
{% endif %}
{% for module_path, class_names in imports.items() %}
from {{ module_path }} import {{ class_names|sort|join(', ') }}
{% endfor %}


class {{ model.metadata.name }}:
    """{{ model.metadata.description }}
{% if model.metadata.parameters %}

    Parameters:
{% for param in model.metadata.parameters %}
        {{ param.name }}: {{ param.description if param.description else '(' + param.type + ')' }}
{% endfor %}
{% endif %}
    """

    def __init__(self{% if model.needs_time_manager() %}, time_manager: TimeManager{% endif %}{% for param in model.metadata.parameters %}, {{ param.name }}={{ param.value }}{% endfor %}):
        """Initialize {{ model.metadata.name }}

        Args:
{% if model.needs_time_manager() %}
            time_manager: Time manager for stateful blocks
{% endif %}
{% for param in model.metadata.parameters %}
            {{ param.name }}: {{ param.description if param.description else '(' + param.type + ')' }}
{% endfor %}
        """
{% if model.needs_time_manager() %}
        self.time_manager = time_manager
{% endif %}
{% for param in model.metadata.parameters %}
        self.{{ param.name }} = {{ param.name }}
{% endfor %}

        # Instantiate CDL blocks
{% for instance in model.get_computation_order() %}
        self.{{ instance.instance_name }} = {{ instance.get_python_import_path()[1] }}(
{% if instance.needs_time_manager() %}
            time_manager=self.time_manager,
{% endif %}
{% for param_name, param_value in instance.parameters.items() %}
            {{ param_name }}={{ param_value }},
{% endfor %}
        )
{% endfor %}

    def compute(self{% for input in model.metadata.inputs %}, {{ input.name }}{% endfor %}) -> Dict[str, Any]:
        """Compute outputs

        Args:
{% for input in model.metadata.inputs %}
            {{ input.name }}: {{ input.description if input.description else input.type.value }}
{% endfor %}

        Returns:
            Dictionary with outputs:
{% for output in model.metadata.outputs %}
                '{{ output.name }}': {{ output.description if output.description else output.type.value }}
{% endfor %}
        """
{{ compute_body }}
